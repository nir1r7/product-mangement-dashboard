<!DOCTYPE html>
<html>
<head>
    <title>Test Admin Endpoints</title>
</head>
<body>
    <h1>Test Admin Endpoints</h1>
    
    <div>
        <h2>Login as Admin</h2>
        <button onclick="loginAdmin()">Login Admin</button>
    </div>
    
    <div>
        <h2>Test Admin Orders Endpoint</h2>
        <button onclick="testAdminOrders()">Test GET /api/orders/admin/orders</button>
    </div>
    
    <div>
        <h2>Test Regular Orders Endpoint</h2>
        <button onclick="testRegularOrders()">Test GET /api/orders</button>
    </div>
    
    <div>
        <h2>Create Test Order</h2>
        <button onclick="createTestOrder()">Create Test Order</button>
    </div>

    <div>
        <h2>Login as Regular User</h2>
        <button onclick="loginRegularUser()">Login Regular User</button>
    </div>
    
    <div id="output"></div>

    <script>
        function log(message) {
            const output = document.getElementById('output');
            output.innerHTML += '<p>' + message + '</p>';
        }

        async function loginAdmin() {
            try {
                const response = await fetch('http://localhost:5000/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        email: 'admin@example.com', 
                        password: 'admin123'
                    }),
                });

                const data = await response.json();
                
                if (response.ok) {
                    log('✅ Admin login successful');
                    localStorage.setItem('token', data.token);
                    
                    // Decode token to check role
                    const payload = JSON.parse(atob(data.token.split('.')[1]));
                    log('✅ Token payload: ' + JSON.stringify(payload));
                    log('✅ Is Admin: ' + (payload.role === 'admin'));
                } else {
                    log('❌ Failed to login admin: ' + data.error);
                }
            } catch (error) {
                log('❌ Error logging in admin: ' + error.message);
            }
        }

        async function testAdminOrders() {
            const token = localStorage.getItem('token');
            if (!token) {
                log('❌ No token found. Please login first.');
                return;
            }

            try {
                const response = await fetch('http://localhost:5000/api/orders/admin/orders', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    log('✅ Admin orders endpoint works: ' + JSON.stringify(data, null, 2));
                } else {
                    const errorData = await response.json();
                    log('❌ Admin orders endpoint failed: ' + JSON.stringify(errorData));
                }
            } catch (error) {
                log('❌ Error testing admin orders: ' + error.message);
            }
        }

        async function testRegularOrders() {
            const token = localStorage.getItem('token');
            if (!token) {
                log('❌ No token found. Please login first.');
                return;
            }

            try {
                const response = await fetch('http://localhost:5000/api/orders', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    log('✅ Regular orders endpoint works: ' + JSON.stringify(data, null, 2));
                } else {
                    const errorData = await response.json();
                    log('❌ Regular orders endpoint failed: ' + JSON.stringify(errorData));
                }
            } catch (error) {
                log('❌ Error testing regular orders: ' + error.message);
            }
        }

        async function createTestOrder() {
            const token = localStorage.getItem('token');
            if (!token) {
                log('❌ No token found. Please login first.');
                return;
            }

            try {
                // First get a product to order
                const productsResponse = await fetch('http://localhost:5000/api/products?limit=1');
                const productsData = await productsResponse.json();
                
                if (!productsData.products || productsData.products.length === 0) {
                    log('❌ No products found to create order');
                    return;
                }

                const product = productsData.products[0];
                
                const orderData = {
                    items: [{
                        product: product._id,
                        quantity: 1,
                        price: product.price
                    }],
                    total: product.price,
                    shippingAddress: {
                        address: '123 Test St',
                        city: 'Test City',
                        state: 'Test State',
                        zipCode: '12345'
                    }
                };

                const response = await fetch('http://localhost:5000/api/orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(orderData)
                });

                if (response.ok) {
                    const data = await response.json();
                    log('✅ Test order created: ' + JSON.stringify(data, null, 2));
                } else {
                    const errorData = await response.json();
                    log('❌ Failed to create test order: ' + JSON.stringify(errorData));
                }
            } catch (error) {
                log('❌ Error creating test order: ' + error.message);
            }
        }

        async function loginRegularUser() {
            try {
                const response = await fetch('http://localhost:5000/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'test@example.com',
                        password: 'password123'
                    }),
                });

                const data = await response.json();

                if (response.ok) {
                    log('✅ Regular user login successful');
                    localStorage.setItem('token', data.token);

                    // Decode token to check role
                    const payload = JSON.parse(atob(data.token.split('.')[1]));
                    log('✅ Token payload: ' + JSON.stringify(payload));
                    log('✅ Is Regular User: ' + (payload.role === 'user'));
                } else {
                    log('❌ Failed to login regular user: ' + data.error);
                }
            } catch (error) {
                log('❌ Error logging in regular user: ' + error.message);
            }
        }
    </script>
</body>
</html>
